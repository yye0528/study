/*
 * main.cpp
 *
 *  Created on: Sep 2, 2013
 *      Author: ryan
 */


#include <stdio.h>
#include <cstdlib>
#include <iostream>
#include <iomanip>
#include <string.h>
#include <fstream>
#include <sstream>

#include <dirent.h>

#include <sys/types.h>
#include <sys/stat.h>

#include <pwd.h>
#include <grp.h>
#include <time.h>
#include <locale.h>
#include <langinfo.h>
#include <stdint.h>

using namespace std;

class Console{
	private:
		string cmd;
		string currDir;
	public:
		Console():cmd(""),currDir("/home/ryan")
			{}

		void usrinput(){
			//get command from user input
			do{
		    	cout<<"$";
		    	getline(cin,cmd);
		    	if (cmd=="list-short"){
		    		ls(currDir); //call list-short
		    	}else if(cmd=="list-long"){
		    		ls(currDir,true); // call list-long
		    	}else if(cmd.find("change")!=string::npos){
		    		string targetDir=cmd.erase(0,7); //get dir by removing "change" from command
		    		currDir=targetDir;
		    	}
		    }while(cmd != "exit");

		}

		//list-short
		void ls(string currDir){
			DIR *dir;
			struct dirent *entry;

		    if(dir=opendir(currDir.c_str())){
				while((entry = readdir(dir))!=NULL){
					cout<<entry->d_name<<"\n";
				}
				closedir(dir);
			}else{
				cout<<"error in openning the file \n";
			}
		}

		//list-long
		void ls(string currDir, bool isLong){
			DIR *dir;
			struct dirent *entry;
			struct stat statBuf;
			string usrInfo;

		    if(dir=opendir(currDir.c_str())){
				while((entry = readdir(dir))!=NULL){

					if(stat(entry->d_name, &statBuf) !=-1){
						usrInfo=statBuf.st_mode;
					}
					cout<<usrInfo<<" "<<entry->d_name<<"\n";
				}
				closedir(dir);
			}else{
				cout<<"error in openning the file \n";
			}
		}
};

int main(){
	Console console;
	console.usrinput();
    return 0;
}


